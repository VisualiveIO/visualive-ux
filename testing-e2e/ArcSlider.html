<!DOCTYPE html>
<html>
  <head>
    <title>Zea Ux</title>
    <style>
      #angle-display {
        position: fixed;
        bottom: 15px;
        right: 20px;
        color: white;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <div id="angle-display" class="angle-display"></div>

    <script type="module">
      import {
        GLRenderer,
        Scene,
        Vec3,
        Xfo,
        Quat,
        EulerAngles,
        Color,
        AssetItem,
        Cylinder,
        Material,
        GeomItem,
        NumberParameter,
      } from './libs/zea-engine/dist/index.esm.js'
      import { ArcSlider } from './libs/zea-ux/dist/index.rawimport.js'

      const scene = new Scene()
      const domElement = document.getElementById('app')
      const renderer = new GLRenderer(domElement, { hideSplash: true })
      renderer.setScene(scene)

      scene.setupGrid(1.0, 10)

      const arcSlider = new ArcSlider('BrakePedalSlider')

      //arcSlider.getParameter('Handle Radius').setValue(0.013)
      arcSlider.getParameter('Arc Radius').setValue(0.7)
      arcSlider.getParameter('Arc Angle').setValue(0.9)
      scene.getRoot().addChild(arcSlider)

      const angleParam = new NumberParameter('Angle')
      scene.getRoot().addParameter(angleParam)
      arcSlider.setTargetParam(angleParam)

      const angleElement = document.getElementById('angle-display')
      arcSlider.on('dragStart', () => {
        angleElement.textContent = `dragEnd: ${angleParam.getValue()}`
      })
      arcSlider.on('dragEnd', () => {
        angleElement.textContent = `dragEnd: ${angleParam.getValue()}`
      })
      angleParam.on('valueChanged', () => {
        angleElement.textContent = `Angle: ${angleParam.getValue()}`
      })

      renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(2, 2, 1), new Vec3(0.5, 0, 0.0))

      // {{{ Messages handler.
      const handleMessage = (event) => {
        const { data } = event

        if (data === 'front') {
          renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(1, 1, 1.7), new Vec3(0, 0, 0))
          window.postMessage(`done-${data}`)
        } else if (data === 'back') {
          renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(-1, -1, 1.7), new Vec3(0, 0, 0))
          window.postMessage(`done-${data}`)
        }
      }

      window.addEventListener('message', handleMessage, false)
      // }}}
    </script>
  </body>
</html>
